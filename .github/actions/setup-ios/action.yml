name: 'Setup iOS Environment'
description: 'Common setup for iOS builds with Xcode, Ruby, SPM cache, and Gradle'

inputs:
  xcode-version:
    description: 'Xcode version to use'
    required: true
  spm-cache-path:
    description: 'Path to SPM dependencies for caching'
    required: false
    default: 'ios/SourcePackages'

runs:
  using: 'composite'
  steps:
    - name: ğŸ“€ Setup Xcode version
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: ${{ inputs.xcode-version }}

    - name: ğŸ’ Set up Ruby
      uses: ruby/setup-ruby@v1
      with:
        bundler-cache: true

    - name: Cache SPM dependencies
      uses: actions/cache@v5
      with:
        path: ${{ inputs.spm-cache-path }}
        key: ${{ runner.os }}-spm-${{ github.sha }}
        restore-keys: |
          ${{ runner.os }}-spm-

    - name: ğŸ˜ Setup Gradle
      uses: ./.github/actions/setup-gradle

    - name: ğŸ§¹ Clear Derived Data
      shell: bash
      run: bundle exec fastlane clear_derived_data_lane
